---
title: "(Не)изменяемые строки в dotnet"
date: 2023-01-02T08:21:49+03:00
draft: true
description: Однажды кто-то принес задачу с собеседования "изменить строку в dotnet". Эта задача показалась мне чрезвычайно любопытной не столько в своем решении, сколько в своей формулировке. И вот, спустя пол года я все же смог заставить себя написать про это заметку.
---

Однажды кто-то принес задачу с собеседования "изменить строку в dotnet". Эта задача показалась мне чрезвычайно любопытной не столько в своем решении, сколько в своей формулировке. И вот, спустя пол года я все же смог заставить себя написать про это.

Начать, думаю стоит с того, чтобы разобраться в том, что из себя представляют строки. В целом по [ссылке](https://learn.microsoft.com/ru-ru/dotnet/csharp/programming-guide/strings/) вы можете получить исчерпывающее описание того чем являются строки в dotnet и как с ними работать, однако позволю себе повториться (тем более, как говорят, это может положительно сказаться на SEO моего блога). Строки в dotnet являются упорядоченной, предназначенной только для чтения, коллекцией объектов типа `Char`, которые представляют собой отдельные символы строки. Под "предназначенной только для чтения" я подразумеваю, что строки являются иммутабельным (неизменяемым) типом и каждая операция над строкой в действительности не изменяет оригинальную строку, а возвращает новый объект строки. 

Вовремя подготовки материала для статьи я наткнулся на [замечательный ресурс](https://csharpindepth.com/Articles/Strings), рассказывающий о строках в dotnet практически все. Нас же с вами сейчас больше интересует следующая фраза: "Essentially, a string is a character array in memory, plus the length of the array and the length of the string (in characters)." (По сути, строка — это массив символов в памяти, плюс длина массива и длина строки (в символах)). А интересует нас это в качестве подводки к тому, что строка это массив `Char`, следовательно указатель на строку указывает на первый элемент этого массива и если бы у нас была возможность работать с указателями, то мы могли бы поменять значение элемента массива не меняя указателя на сам массив. И такая возможность в dotnet есть. Для этого нам потребуется:
- ~~Пластиковая бутылка~~
- Разрешить в `.csproj` использование небезопасных блоков кода:
  ```xml
  <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
  ```  
- С помощью оператора `fixed` предотвратить перемещение сборщиком мусора нашей строки и получить указатель на первый ее символ.

```csharp
var a = "Hello, World!";
unsafe
{
    fixed(char* c = a)
    {
        *c = 'T';
    }
}
Console.WriteLine(a); // Tello, World!
```